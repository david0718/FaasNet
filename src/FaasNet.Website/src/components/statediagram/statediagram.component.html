<div fxLayout="row" class="statediagram">
  <div fxFlex="20%" class="toolbox">
    <mat-list>
      <mat-list-item class="toolbox-item" draggable="true" (dragstart)="onDragStart($event, 'inject')">
        Inject State
      </mat-list-item>
      <mat-divider></mat-divider>
      <mat-list-item class="toolbox-item" draggable="true" (dragstart)="onDragStart($event, 'switch')">
        Switch state
      </mat-list-item>
      <mat-divider></mat-divider>
    </mat-list>
  </div>
  <div fxFlex="80%">
    <div class="editor">
      <svg [attr.viewBox]="viewBox" [attr.width]="options.canvasWidth" [attr.height]="options.canvasHeight" #stateDiagram>
        <g>
          <defs>
            <marker id="statediagram-barbEnd" refX="19" refY="7" markerWidth="20" markerHeight="14" markerUnits="strokeWidth" orient="auto">
              <path d="M 19,7 L9,13 L14,7 L9,1 Z"></path>
            </marker>
          </defs>
          <g class="root">
            <g>
              <!--  Start Circle -->
              <g>
                <circle [attr.class]="circleStartSelected ? 'start selected' : 'start'" [attr.r]="options.circleRadius" [attr.cx]="circleStartPosition.x" [attr.cy]="circleStartPosition.y"></circle>
                <foreignObject [attr.width]="options.circleRadius * 2" [attr.height]="options.circleRadius * 2" [attr.x]="circleStartPosition.x - options.circleRadius" [attr.cy]="circleStartPosition.y">
                  <div class="draggableZone" (drop)="onDropCircleStart($event)" (dragover)="onDragOverCircleStart($event)" (dragleave)="onDragLeaveCircleStart($event)"></div>
                </foreignObject>
              </g>
              <!-- Edge Paths -->
              <g class="edgePaths">
                <path [attr.d]="edgePathCircleStart" marker-end="url(#statediagram-barbEnd)" [style.display]="stateMachine?.isEmpty ? 'none' : 'block'" />
                <path [attr.d]="edgePath.path" *ngFor="let edgePath of edgePaths" marker-end="url(#statediagram-barbEnd)" />
              </g>
              <!-- Edge Labels -->
              <g class="edgeLabels">
                <foreignObject *ngFor="let edgeLabel of edgeLabels" [attr.x]="edgeLabel.posX" [attr.y]="edgeLabel.posY" [attr.width]="edgeLabel.width" [attr.height]="edgeLabel.height">
                  <div class="edgeLabel">
                    <div class="textContainer" [style.lineHeight]="edgeLabel.height + 'px'">
                      <span class="text">
                        {{ edgeLabel.label }}
                      </span>
                    </div>
                  </div>
                </foreignObject>
              </g>
              <!-- States -->
              <g *ngFor="let node of nodes" class="state" [attr.transform]="node.transform">
                <rect [attr.width]="options.nodeWidth" [attr.height]="options.nodeHeight"></rect>
                <line x1="0" [attr.y1]="options.titleHeight" [attr.x2]="options.nodeWidth" [attr.y2]="options.titleHeight" class="separator"></line>
                <g>
                  <foreignObject [attr.width]="options.nodeWidth" [attr.height]="options.titleHeight">
                    <div class="header">
                      {{node.state?.name}}
                      <div class="actions">
                        <mat-icon (click)="openSettings(node)">settings</mat-icon>
                        <mat-icon (click)="removeNode(node)">delete</mat-icon>
                      </div>
                    </div>
                  </foreignObject>
                  <foreignObject [attr.width]="options.nodeWidth" [attr.height]="options.bodyHeight" [attr.transform]="'translate(0, '+options.titleHeight+')'">
                    <div>description</div>
                  </foreignObject>
                </g>
              </g>
              <!-- Anchors -->
              <g class="anchors">
                <g *ngFor="let anchor of anchors" [attr.transform]="anchor.transform" [attr.class]="anchor.selected ? 'anchor selected' : 'anchor'">
                  <circle [attr.r]="options.circleRadius" class="outer"></circle>
                  <circle r="4" class="inner"></circle>
                </g>
              </g>
              <!-- Draggable Zone -->
              <g class="draggableZones">
                <foreignObject *ngFor="let draggableZone of draggableZoneLst" [attr.x]="draggableZone.x" [attr.y]="draggableZone.y" [attr.width]="draggableZone.width" [attr.height]="draggableZone.height">
                  <div class="draggableZone" (drop)="onDrop($event, draggableZone)" (dragover)="onDragOver($event, draggableZone)" (dragleave)="onDragLeave($event, draggableZone)"></div>
                </foreignObject>
              </g>
            </g>
          </g>
        </g>
      </svg>
    </div>
  </div>
</div>
